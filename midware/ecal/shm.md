## 1、共享内存机制

ecal 共享内存的一些机制

### optional

#### 1、握手机制

防止订阅端数据处理过慢，发送端口数据已经发送，然后旧的数据被覆盖。有了这个机制，发送端至多会阻塞 memfile_ack_timeout 的时间，这样会减少数据的丢失，但是会导致发送端的频率下降的情况。(单位是毫秒)

```
[publisher]
memfile_ack_timeout=100
```

#### 2、零拷贝机制

eCAL 默认的共享内存机制下，数据至少还会产生两次拷贝。

1、发布者将共享内存拷贝到共享内存文件中。

2、每一个订阅者将共享内存数据拷贝到自己的私有数据中。（存在多次拷贝）

官方解释：在执行回调函数之前，从共享内存文件将消息拷贝到订阅者自己的空间中是为了更好的解耦。这样让发布者可以发送更新下一条数据，同事回调函数可以处理上一个消息。

过小的消息不会因为零拷贝产生性能的提升？大的消息才能在零拷贝中受收益。

#### 3、 多缓冲模式

eCAL 默认使用一个共享内存文件对应一个发布者。但是一个文件也许会导致性能的降低，内存文件被订阅者复制的时候，由于需要获取锁，会导致文件被阻塞。

```
[publisher]
memfile_buffer_count = 3
```

```
eCAL::protobuf::CPublisher<pb::People::Person> pub("person");
pub.ShmSetBufferCount(3);
```

可以将多缓冲模式和零拷贝相结合，提升性能。

## 2、零拷贝

